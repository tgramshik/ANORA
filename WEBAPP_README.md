# ü§ñ –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è WebApp —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è Telegram Bot

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç Telegram WebApp —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ —Å –æ–±—ã—á–Ω—ã–º–∏ –∫–Ω–æ–ø–∫–∞–º–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (KeyboardButton), —Ç–∞–∫ –∏ —Å –∏–Ω–ª–∞–π–Ω –∫–Ω–æ–ø–∫–∞–º–∏ (InlineKeyboardButton).

## üîß –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
1. **webapp_handler.py** - –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ WebApp –¥–∞–Ω–Ω—ã—Ö
2. **webapp_server.py** - Flask HTTP —Å–µ—Ä–≤–µ—Ä –¥–ª—è InlineKeyboardButton
3. **bolt/src/hooks/useTelegram.ts** - –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π JavaScript –∫–ª–∏–µ–Ω—Ç

### –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:
- **KeyboardButton** ‚Üí `tg.sendData()` ‚Üí –±–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç `web_app_data`
- **InlineKeyboardButton** ‚Üí `fetch()` ‚Üí Flask —Å–µ—Ä–≤–µ—Ä ‚Üí `answerWebAppQuery` ‚Üí –±–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–î–æ–±–∞–≤—å—Ç–µ –≤ `config.py`:
```python
# WebApp —Å–µ—Ä–≤–µ—Ä
WEBAPP_PORT = 8080
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install flask>=2.3.3
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ URL –≤ WebApp

–í —Ñ–∞–π–ª–µ `bolt/src/hooks/useTelegram.ts` –∑–∞–º–µ–Ω–∏—Ç–µ:
```typescript
const BACKEND_URL = 'http://localhost:8080';
```

–ù–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞:
```typescript
const BACKEND_URL = 'https://your-domain.com:8080';
```

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞: `python bot.py`
2. WebApp —Å–µ—Ä–≤–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç—É 8080
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ ngrok –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å –≤–Ω–µ—à–Ω–∏–º URL:
   ```bash
   ngrok http 8080
   ```

### –ü—Ä–æ–¥–∞–∫—à–Ω
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è Telegram WebApp)
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ reverse proxy (nginx/apache)
3. –û–±–Ω–æ–≤–∏—Ç–µ `BACKEND_URL` –≤ JavaScript –∫–æ–¥–µ
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–µ–∂—Å–µ—Ç–µ–≤–æ–π —ç–∫—Ä–∞–Ω –¥–ª—è –ø–æ—Ä—Ç–∞ 8080

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –≤ –ø—Ä–æ–¥–∞–∫—à–Ω
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ CORS –ø–æ–ª–∏—Ç–∏–∫–∏
- –í–∞–ª–∏–¥–∏—Ä—É–π—Ç–µ –≤—Å–µ –≤—Ö–æ–¥—è—â–∏–µ –¥–∞–Ω–Ω—ã–µ
- –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –ø–æ—Ä—Ç—É WebApp —Å–µ—Ä–≤–µ—Ä–∞

### –ü—Ä–∏–º–µ—Ä nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
```nginx
server {
    listen 443 ssl;
    server_name your-domain.com;
    
    location /webapp/ {
        proxy_pass http://localhost:8080/webapp/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã:
1. –°–æ–∑–¥–∞–π—Ç–µ –æ–±—ã—á–Ω—É—é –∫–Ω–æ–ø–∫—É —Å WebApp
2. –°–æ–∑–¥–∞–π—Ç–µ –∏–Ω–ª–∞–π–Ω –∫–Ω–æ–ø–∫—É —Å WebApp
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–±–∞ —Ç–∏–ø–∞ –∫–Ω–æ–ø–æ–∫ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–µ—Ä–µ–¥–∞—é—Ç –¥–∞–Ω–Ω—ã–µ

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞: `[WEBAPP]` –ø—Ä–µ—Ñ–∏–∫—Å
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Flask —Å–µ—Ä–≤–µ—Ä–∞: `[WEBAPP_SERVER]` –ø—Ä–µ—Ñ–∏–∫—Å
- Health check: `GET /webapp/health`

## üìù API Endpoints

### POST /webapp/inline
–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ—Ç InlineKeyboardButton WebApp
```json
{
  "query_id": "string",
  "data": {
    "action": "string",
    "user_id": "number",
    ...
  }
}
```

### GET /webapp/health
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞
```json
{
  "status": "ok",
  "handler_initialized": true
}
```

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
1. **–û—à–∏–±–∫–∞ CORS** - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –≤ Flask
2. **Handler not initialized** - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—è–¥–æ–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ bot.py
3. **Connection refused** - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –∏ –ø–æ—Ä—Ç –¥–æ—Å—Ç—É–ø–µ–Ω

### –û—Ç–ª–∞–¥–∫–∞:
–í–∫–ª—é—á–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
```python
logging.basicConfig(level=logging.DEBUG)
```
